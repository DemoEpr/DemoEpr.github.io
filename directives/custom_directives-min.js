"use strict";angular.module("sarl.directives",["charts"]).factory("RecursionHelper",["$compile",function(e){return{compile:function(t,n){angular.isFunction(n)&&(n={post:n});var o,i=t.contents().remove();return{pre:n&&n.pre?n.pre:null,post:function(t,l){o||(o=e(i)),o(t,function(e){l.append(e)}),n&&n.post&&n.post.apply(null,arguments)}}}}}]).directive("modalInstrumento",["LogFactory",function(e){return{restrict:"E",templateUrl:"directives/modal.html",scope:{data:"=",idModal:"@",confirmFn:"&"},controller:function(t){var n=this;n.debug=function(){console.log(e)},n.__init__=function(){n.log=e[t.idModal],n.actived_log=[]},n.change_log=function(e){console.log("Change log modal",e,t.idModal),n.actived_log=n.get_log_history(e)},n.get_log_history=function(e){return e in n.log?n.log[e]:(n.log[e]=[],n.log[e])},n.confirm=function(e){var o=t.confirmFn({concepto:e});return n.add_history_field(e),o},n.add_history_field=function(e){var t=e.irlId,o=e.valor,i=n.get_log_history(t),l=i.length;if(l>0)var a=i[l-1].actual;else var a="";var r={username:"Juan Camilo David",date:new Date,last:a,actual:o};i.push(r)},n.__init__()},controllerAs:"ctrl"}}]).directive("tree",["RecursionHelper",function(e){return{restrict:"E",scope:{family:"=",confirmFn:"&",changeLogFn:"&"},template:'<div ng-repeat="child in family.campos">     <concept confirm-fn="confirm(concepto)" change-log-fn="change_log(field_id)" data="child" childs="child.campos" terminal="child.terminal"              name="{{child.text}}" irl-id="{{child.id}}" confirm="child.confirm">     </concept>     <tree family="child"></tree> </div>',compile:function(t){return e.compile(t,function(e,t,n,o,i){})},controller:function(e){e.confirm=function(t){return e.confirmFn({concepto:t})},e.change_log=function(t){console.log("change log tree"),e.changeLogFn({field_id:t})}}}}]).directive("concept",[function(){return{restrict:"E",template:'<div>     \x3c!--Data:{{ data }}<br>--\x3e     <label for="{{ irlId }}" style="white-space:pre">{{ name | longString: 23 }}</label>     <input ng-change="ctrl.update()" ng-disabled="!terminal" type="text" id="{{ irlId }}" ng-model="ctrl.mods_value"         ng-focus="ctrl.show_edit_form()" data-ng-blur="ctrl.hide_edit_form($event)">     <button type"button" class="btn btn-xs" ng-mousedown="ctrl.confirm()" id="confirm"     ng-class=\'{"btn-success": confirm, "btn-danger": !confirm}\'>Confirmar</button>      <br>      <div ng-show="ctrl.get_state()">         <button type="button" class="btn btn-success btn-xs" ng-mousedown="ctrl.save_value()">Guardar</button>          <button class="btn btn-warning btn-xs" ng-mousedown="ctrl.restore_value()">             <span class="glyphicon glyphicon-remove" style="vertical-align:middle"></span>         </button>     </div>      <div ng-show="ctrl.has_changes() && !ctrl.state">         <p style="display: inline;">Tiene modificaciones sin guardar</p>         <a id="view" href style="display: inline;" ng-mousedown="ctrl.view_editions()">Ver</a>         <a id="omit" href style="display:inline;" ng-mousedown="ctrl.omit_edition()">Descartar</a>     </div> </div> <br>',scope:{childs:"=",data:"=",terminal:"=",confirm:"=",irlId:"@",name:"@",confirmFn:"&",changeLogFn:"&"},controller:function(e){var t=this;t.state=!1,t.saved_value="",t.mods_value="",t.last_edition="",this.show_edit_form=function(){console.log("focus"),t.change_log(),t.state=!0,angular.element("#"+e.irlId).select()},this.has_changes=function(){return t.saved_value!=t.last_edition},this.hide_edit_form=function(e){console.log("blur",t.state,t.has_changes()),t.state=!1;var n=e.relatedTarget;if(null==n)t.mods_value=t.saved_value;else{switch(n.id){case"view":t.state=!0,t.view_editions();break;case"confirm":break;default:t.state=!1,t.mods_value=t.saved_value}}},this.get_state=function(){return t.state},this.omit_edition=function(){t.last_edition=t.saved_value},this.update=function(){console.log("update"),t.last_edition=t.mods_value},this.save_value=function(){console.log("Guardar",t.saved_value,t.mods_value),t.saved_value=t.mods_value,e.data.confirm=!1,t.state=!1},this.view_editions=function(){console.log("ver ediciones"),t.mods_value=t.last_edition,angular.element("#"+e.irlId).trigger("focus")},this.restore_value=function(){t.mods_value=t.saved_value,t.last_edition=t.saved_value},this.confirm=function(){if(console.log("confirmar"),angular.element("#"+e.irlId).trigger("focus"),!0===e.data.terminal){t.save_value();var n=e.confirmFn({concepto:{irlId:e.irlId,valor:t.mods_value}});!0===n&&(e.data.confirm=n)}else console.log("NO soy terminal IMPLEMENTAR")},this.change_log=function(){console.log("change log concept");var t=e.irlId;e.changeLogFn({field_id:t})}},controllerAs:"ctrl"}}]).directive("initDisplay",[function(){return{restrict:"E",scope:{indInfo:"=info"},templateUrl:"public/initDisplay.html",controller:function(e){this.get_class=function(){var t=e.indInfo.color;return"green"==t?"alert alert-success":"red"==t?"alert alert-danger":"alert alert-warning"}},controllerAs:"ctrl"}}]).directive("newsDisplay",function(){return{restrict:"E",scope:{newsInfo:"="},templateUrl:"/public/newsDisplay.html"}}).directive("tooltip",function(){return{restrict:"A",link:function(e,t,n){$(t).hover(function(){$(t).tooltip("show")},function(){$(t).tooltip("hide")})}}}).directive("pannel",function(){return{scope:{title:"@",collapsed:"="},transclude:!0,template:'<div class="col-md-3 animate"      style="position: relative; background-color: white; border-right-style: groove; border-right-width: 1px; height: calc(100vh - 165px); padding-top: -20px"      ng-class="{colapsar: collapsed}">  <button style="position: relative; top: -10px; z-index: 1000;" type="button" class="btn btn-default col-md-offset-10" ng-click="collapsed = !collapsed;">     <span ng-class="[\'glyphicon\', {\'glyphicon glyphicon-chevron-right\': collapsed, \'glyphicon glyphicon-chevron-left\': !collapsed}]"></span> </button>  <div style="overflow: hidden">     <h2>{{ title }}</h2>     <ng-transclude></ng-transclude> </div> </div>'}}).directive("groupConcept",[function(){return{restrict:"E",scope:{action:"&",fields:"=",text:"@",confirmed:"="},templateUrl:"directives/concepts/view_general_concept.html",controller:function(e){var t=this;t.__init__=function(){t.flag_edit_form=!1,t.confirmed=!1;for(var n=[],o=0;o<e.fields.length;o++){var i=e.fields[o];n.push({saved_value:i.value,mod_value:i.value,last_edition:"",confirmed:i.confirm,id:i.id,type:i.type})}t.models=n},t.has_changes_specific=function(e){return""!==t.models[e].last_edition},t.has_changes=function(){for(var e=0;e<t.models.length;e++)if(t.has_changes_specific(e))return!0;return!1},t.show_edit_form=function(){t.flag_edit_form=!0},t.hide_edit_form=function(e){console.log("blur",t.flag_edit_form,t.has_changes()),t.flag_edit_form=!1;var n=e.relatedTarget;if(console.log(n),null===n)t.show_saved_values();else{switch(n.id){case"view":t.view_editions();break;case"tab_instrumentos":t.show_saved_values()}}},t.show_saved_values=function(){for(var e=0;e<t.models.length;e++)t.show_saved_value_specific(e)},t.show_saved_value_specific=function(e){var n=t.models[e];n.mod_value=n.saved_value},t.show_modifications_form=function(){t.flag_modifications_form=!0},t.get_flag_edit_form=function(){return t.flag_edit_form},t.get_model=function(e){return t.models[e]},t.update=function(e){var n=t.models[e];n.last_edition=n.mod_value!==n.saved_value?n.mod_value:""},t.save_values=function(){console.log("save values");for(var n=0;n<t.models.length;n++)if(t.has_changes_specific(n)){var o=t.models[n];o.saved_value=o.last_edition,o.last_edition="",e.confirmed=!1}t.flag_edit_form=!1},t.view_editions=function(){console.log("ver ediciones");for(var e=t.models.length-1;e>=0;e--)if(t.has_changes_specific(e)){var n=t.models[e];n.mod_value=n.last_edition,console.log("ejeeeeeeeee",n.id),angular.element("#"+n.id).trigger("focus")}},t.get_color=function(e){return t.has_changes_specific(e)?"orange":"black"},t.restore_values=function(){for(var e=0;e<t.models.length;e++){var n=t.models[e];n.mod_value=n.saved_value,n.last_edition=""}},t.get_tam=function(e){return e||2},t.get_icon=function(e){switch(e){case"percent":return"glyphicon glyphicon-asterisk";case"number":return"glyphicon glyphicon-usd";case"calendar":return"glyphicon glyphicon-calendar";case"integer":return"glyphicon glyphicon-stats";default:return"glyphicon glyphicon-usd"}},t.confirm=function(){e.confirmed=!0,console.log("Se ha confirmado un concepto GROUP",t.models),e.action({concepto:t.models})},t.__init__()},controllerAs:"gCtrl"}}]);